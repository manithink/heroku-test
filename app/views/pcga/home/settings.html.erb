
   <%= tinymce %>

    <%= render "settings_navigation_top" %>
    <div class="inputs-details">
    <div class="row">
          <div class="upload">
            <p>Upload Logo</p>
            <%= form_for @image, url: '/pcga/upload_settings_images',:html => {:multipart => true} do |f| %>
              <%= f.file_field :image , id: "image_upload" %>
              <%= f.submit "Upload" ,:class => "farCare-btn upload-btn settings-btn" ,:id => "upload_button" %>
              <span style="float: right; margin-top: 2%;" class="error" >&nbsp;</span>
              <% end %>
              </div>
              </div>
              <div class="row">
            <table width="100%" cellspacing="0" cellpadding="0" class="upload-list">
                <% if @images.present? %>
                  <% @images.each do |image| %>
                  <tr>
                  <td width="95%"><%= truncate(image.image.url.split('/')[-1], length: 100, omission: "...") %></td>
                  <td align="center" width="5%">
                    <%= link_to '', "/pcga/images/#{image.id}/delete", class: 'delete'  %>
                  </td>
                  </tr>
                <% end %>
              <% else %>
                <tr>
                <td>No Images</td>
                </tr>
              <% end %>
          </table>
            <span class="help-text">(Transparent .png is Preferred. Size 196x116px)</span>
           </div>
      <%= simple_form_for(@admin_data, :url => pcga_save_settings_path, method: :patch, validate: true) do |f| %>
      <div class="row">
      	<div class="first-input-box">
        	<p>Custom URL</p>
          <div>
            <%= f.text_field :custom_url, :id => "custom_url" %>
          </div>
            <span class="help-text">(Your Website Url is <font color="#3fbc9a"><span id="url">localhost:3000/<%= @admin_data.custom_url %></span></font>)</span>
        </div>
      </div>
      <div class="row">
      	<div class="first-input-box">
        	<p>Youtube URL &nbsp;<span class = "youtube_error" style="color:red;"></span></p>
            <%= f.text_field :youtube_url, :id => "youtube_url" %>
        </div>
      </div>
      <div class="row">
        <p>About Us</p>
        <%= f.text_area :about_us, :class => "tinymce", :id => :about_us %>
      </div>
      <div class="row h-btm">
        <p>Contact Us</p>
        <%= f.text_area :contact_us, :class => "tinymce", :id => :contact_us %>
      </div>
      <div class="row">
    	<input type="submit" value="Save" class="farCare-btn submit first-btn">
        <!-- <input type="button" value="Reset" class="farCare-btn reset"> -->
        <%= link_to (button_tag "Cancel",:type => 'button',:class => "farCare-btn cancel"), pcga_home_index_path, :id => "pcgc_settings_edit_cancel" %>
    </div>
    <% end%>
</div>

<script type="text/javascript">

    $(function(){
        setTinyMCE();
    });

    $('#new_image').submit(function(event){
    $('#upload_button').next('.error').empty();
      var image = $('#image_upload').val();

      if(image == '' || image == undefined){
        // alert("Select an image before uploading!");
        $('#upload_button').next('.error').append("Select an image before uploading!");
        return false;
      }
      else{
        if('<%= @images.count %>' == 1){
          // alert("You have exceed the limit!");
          $('#upload_button').next('.error').append("Delete the uploaded logo!");
          return false;
        }else {
          var ext = image.split('.').pop().toLowerCase();
          if($.inArray(ext, ['png','jpg','jpeg']) == -1) {
              // alert('Invalid image extension!');
              $('#upload_button').next('.error').append("Invalid image extension!");
              return false;
          } else {
            var size = $('#image_upload')[0].files[0].size
            if(size >= 2000000){
              // alert('File size must be 2 MB or below');
              $('#upload_button').next('.error').append("File size must be 2 MB or below")
              return false;
            } else{
              return true
            }
          }
        }
      }
    });

    function setTinyMCE(){
      tinyMCE.init({
        mode : "textareas",
        plugins : "insertdatetime,preview, link",

        // Theme options - button# indicated the row# only
        theme_advanced_buttons1 : "newdocument,|,bold,italic,underline,|,justifyleft,justifycenter,justifyright,fontselect,fontsizeselect,formatselect",
        theme_advanced_buttons2 : "cut,copy,paste,|,bullist,numlist,|,outdent,indent,|,undo,redo,|,link,unlink,anchor,image,|,code,preview,|,forecolor,backcolor",
        theme_advanced_buttons3 : "insertdate,inserttime,|,spellchecker,advhr,,removeformat,|,sub,sup,|,charmap,emotions",
        theme_advanced_toolbar_location : "top",
        theme_advanced_toolbar_align : "left",
        theme_advanced_statusbar_location : "bottom",
        theme_advanced_resizing : true
      });
    }

    setTimeout(function() {
        setValue();
    }, 1000);

    function setValue(){
      tinymce.get('about_us').setContent("<%= raw @admin_data.about_us %>");
      tinymce.get('contact_us').setContent("<%= raw @admin_data.contact_us %>");
    }


    $('.delete').click(function(e){
      var link = $(this).attr('href');
      e.preventDefault();
      jConfirm('Do you really want to delete?','Confirmation', function(c){
        if(c == true){
            var self = $(this)
            window.location = link;
        }
      });
    });


    $('#custom_url').keyup(function() {
      var url = "farcare.com/" + ($.trim($('#custom_url').val()));
      $('#url').html(url);
    });

    $('#custom_url').change(function() {
      var url = "farcare.com/" + ($('#custom_url').val());
      $('#url').html(url);
    });

    $('.submit').click(function(event){

      var url =  $('#youtube_url').val();
      if (url != ""){
        var matches = url.match(/(http|https):\/\/(?:www\.)?youtube.com\/watch\?v=([a-zA-Z0-9\-_]+)/);
        if (!matches) {
          event.preventDefault();
          $('.youtube_error').html('Enter valid url');
        }
      }
      else{
        $('.youtube_error').empty();
      }
    });
</script>


