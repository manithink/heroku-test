 <div class="report-wrapper">
  <div id="header">
    <%= wicked_pdf_image_tag(pcga_home_logo,style: "max-width:164")%>
    <div class="address">
      <%= current_user.care_giver_company.admin_setting.contact_us.html_safe %>
    </div>
  </div>
  <!--content starts here-->
<!--   <div align = "center">
    <%# if @user_type == "Care Giver"%>
        Care Giver Work Report
    <%# else %>
        Care Client Time Report
    <%# end %>
  </div> -->
  <div class="content">
    <h2><%= change_name(@user_type) %> Time / Work Report<span>From <%= @start_date.strftime("%m-%d-%Y") %> to <%= @end_date.strftime("%m-%d-%Y") %></span></h2>
    <% @service_record.each do |week_record_index,week_record|%>
    <h3>Summary</h3>
    <table class="report-table break_page" border="0" cellpadding="0" cellspacing="0">
      <tr>
        <th colspan="3"><%= change_name(@user_type) %> Name</th>
        <th colspan="4">Report Generated for period (From <%= week_record.keys.first.strftime("%m-%d-%Y") %> to <%= week_record.keys.last.strftime("%m-%d-%Y") %>)</th> 
      </tr>
      <tr>
        <td width="12%" class="lbl">First Name:</td>
        <td width="22%"><strong><%= @resource.first_name %></strong></td>
        <td width="12%" class="lbl">Last Name:</td>
        <td width="54%"><strong><%= @resource.last_name %></strong></td>
       </tr>
       <tr>
         <td colspan="4" class="inner-table-container">
          <!--inner table starts here-->
            <table class="inner-table" border="0" cellpadding="0" cellspacing="0">
              <tr>
                <th></th>
                <% @total_time = 0.0 %>
                <%  @total_distance = 0 %>
                <% week_record.each do |record_index, record|%>
                  <th>
                     <%= record_index.strftime("%a")%> <br /><%= record_index.strftime("%m-%d-%Y") %>
                  </th>
                <% end %>
                <th width="109" class="bold dark-bg last">Total</th>
              </tr>
              <tr>
                <td class="align-left">Hours Per Day:</td>
                <% week_record.each do |record_index, record|%>
                  <td>
                    <% @sum_time = [] %>
                    <%record .each do |rec| %>
                        <% @sum_time<< (((rec.checked_out_at - rec.checked_in_at).to_f)) rescue nil %>
                    <% end %>
                    <%= time_format(((@sum_time.inject(:+)).to_f).round(2)) %>
                    <% @total_time += (@sum_time.inject(:+)).to_f %>
                  </td>
                <% end %>
                <td class="dark-bg last"><%= time_format(@total_time.round(2)) %></td>
              </tr>
              <tr>
                <td class="align-left">Mileage:</td>
                <% week_record.each do |record_index, record|%>
                  <td>
                    <% @sum_distance = [] %>
                    <%record .each do |rec| %>
                        <% @sum_distance << rec.distance_travelled %>
                    <% end %>
                    <%= @sum_distance.inject(:+).to_i %>
                    <% @total_distance += @sum_distance.inject(:+).to_i %>
                  </td>
                <% end %>
                <td class="dark-bg last"><%= @total_distance %></td>
              </tr>
            </table>
        </td>
    </tr>
</table>
<% week_record.each do |record_index, records|%>
<% unless records.empty? %>
<% unless records.each do |record| %>
<table class="report-table" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="20%" class="lbl"><%= change_name(@other_user_type)%>:</td><td>
            <strong>
                <% if record.send(@other_user_type.gsub(" ","").underscore) %>
                    <%= record.send(@other_user_type.gsub(" ","").underscore).fullname %>
                <% else %>
                    <%= @other_user_type %> has been deleted by the Admin! 
                <% end %>
            </strong>
        </td>
    </tr>
    <tr>
        <td width="8%" class="lbl">Check In:</td>
        <td width="20%" ><%= record.report_date("checked_in") rescue nil %></td>
        <td width="50%"><%= record.report_time("checked_in", @zone) rescue nil %></td>

        <td width="12%"class="lbl">Check Out:</td>
        <td width="6%"><%= record.report_date("checked_out") rescue nil %></td>
        <td width="6%" ><%= record.report_time("checked_out", @zone) rescue nil %></td>
    </tr>
    <tr>
      <td colspan="6" class="inner-table-container">
      <!--inner table starts here-->
        <table class="inner-table left-aligned" border="0" cellpadding="0" cellspacing="0">
          <tr>
            <th>Service Category</th>
            <th>Service Item</th>
            <th>Disposition / Comments </th>
          </tr>
          <% unless record.service_record_json.nil? %>
          <% record.service_record_json.each do |key,value|%>
            <% value.each do |k,v|%>
              <tr>
                <td class="align-left"><%= key %></td>
                <td><%= k %><%= '<span class="mandatory">*</span>'.html_safe if v["is_required"].eql?("true")%></td>
                <td><b>Status:</b> <%= v["is_completed"].eql?("true") ? "Completed" : "Not Completed"%> <% unless v["msg"].empty? %> <b>Comment:</b> <% end %><%= v["msg"]%></td>
                </tr>
            <% end %>
          <% end %>
        </table>
        <!--inner table ends here-->
      </td>
    </tr>
    <tr>
      <td width="13%" class="lbl"><%= change_name(@other_user_type) %>:</td>
      <td colspan="2"><%= record.send(@other_user_type.gsub(" ","").underscore).fullname if record.send(@other_user_type.gsub(" ","").underscore) %></td>
      <td width="12%" class="lbl">Signature:</td>
      <td colspan="2" class="last">
        <%= wicked_pdf_image_tag("/signatures/#{record.id}.png", width: "175", height: "56", alt: "") rescue nil%>
      </td>    
    </tr>
</table>
<% end %>
<% end %>
<% end %>
<% end %>
<% end %>
<% end %> 
<span><span class="mandatory">*</span> Required</span>
</div>
</div>

<style type="text/css">
    /********* Report ***********/

    * {
        padding: 0;
        margin: 0;
    }
    tr, td, th, tbody, thead, tfoot {
        page-break-inside: avoid !important;
    }
    .report-wrapper {
        width: 1000px;
        margin: 0 auto;
        display: table;
        font-size: 13px;
        color: #474747;
        font-family: Verdana, Geneva, sans-serif;
    }
    #header {
        padding: 30px;
        display: table;
        width: 100%;
        border-bottom: 1px solid #e4e4e4;
        -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
        -moz-box-sizing: border-box;    /* Firefox, other Gecko */
        box-sizing: border-box;         /* Opera/IE 8+ */
    }
    .address {
        float: right;
    }
    .address p {
        margin-bottom:10px;
        color: #5a5a5a;
        font-size: 12px;
    }
    p.bold_txt {
        color: #2f2f2f;
        font-size: 16px;
    }
    .content {
        padding: 20px 30px;
        display: block;
    }
    h2 {
        padding: 10px 20px;
        background-color: #2c3e50;
        font-size: 16px;
        margin-bottom: 20px;
        color: #fff;
        font-weight: normal;
    }
    h2 span {
        float: right;
        color: #9caab8;
        font-size: 13px;
    }
    h3 {
        font-size: 18px;
        color: #626262;
        margin-bottom: 20px;
    }
    .report-table {
        width: 100%;
        border: 1px solid #9aabbc;
        margin-bottom: 20px;
    }
    .report-table th {
        color: #2c3e50;
        font-size: 14px;
        padding: 20px 0 20px 20px;
        text-align: left;
        border-bottom: 1px solid #e4e4e4;
    }
    .report-table td {
        padding: 20px 0 20px 20px;
    }
    .report-table td.lbl {
        color: #595959;
        font-weight: bold;
    }
    .report-table td.last, .report-table th.last, .inner-table th.last{
        padding-right: 20px;
    }
    .inner-table{
        width:100%;
    }
    .inner-table th {
        color: #fff;
        padding: 0 0 0 20px;
        text-align: center;
        background-color: #879cb1;
        height: 40px;
        vertical-align: middle;
        font-weight: normal;
        font-size: 13px;
        border-bottom: 0;
    }
    .inner-table td {
        padding: 20px 0 18px 18px;
        border-bottom: 1px solid #e4e4e4;
        text-align: center;
    }
    .inner-table tr.alt td{
        background-color: #e4e4e4;
    }
    .inner-table tr.last td{
        border-bottom: 0;
    }
    .inner-table-container{
        padding: 0 !important;
    }
    .bold{
        font-weight: bold !important;
    }
    .align-left{
        text-align: left !important;
    }
    .dark-bg{
        background-color: #73889c !important;
        color: #fff;
        border-bottom: 0 !important;
    }
    table.left-aligned td, table.left-aligned th{
        text-align: left;
    }
    .leftpad-zero{
        padding-left: 0 !important;
    }
    table.break_page{
        page-break-before: always;  
        page-break-inside: avoid;
    }
    .mandatory{
        color:#ff0000;
    }
</style>