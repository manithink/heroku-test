  <%= javascript_include_tag "fcg/fcg_view_care_clients" %>

<div id="content-block">
  <div class="breadcrum">
    <ul>
      <li><%= link_to "Home",pcga_home_index_path %></li>
      <li class="greater-than"><%= image_tag "greater-than.png", width: "4", height: "7" %></li>
      <li>Care Clients</li>
    </ul>
  </div>
  <h3 class="clear relative m_btm-15">Care Clients
    <%= link_to "Add Care Client",new_fcg_home_path, :class => "farCare-btn add-care-clients" %>
    <%= link_to "Customize Service Plan", ("/fcg/customize_service_plan"),:class => "service-plan farCare-btn" %>
    <!-- <a href="" class="coming_soon service-plan farCare-btn">Customise Service Plan</a> -->
  </h3>
  <div class="row">
    <div class="search relative">
      <%= form_tag fcg_view_care_clients_path, :method => 'get'  do %>
      <%= hidden_field_tag :direction, params[:direction] %>
      <%= hidden_field_tag :sort, params[:sort] %>
      <p>
        <%= text_field_tag :search, params[:search], placeholder: "Search" %>
        <%= submit_tag "", :name => nil, :class => "search-icon"%>
      </p>
      <% end %>
    </div>
  </div>
  <div class="row">
    <table width="100%" cellspacing="0" cellpadding="0" class="farCare-tble sort-table">
      <tr>
      <% unless @care_clients.empty? %>
        <th><%= sortable "first_name" %></th>
        <th><%= sortable "last_name" %></th>
        <th><%= sortable "city" %></th>
        <th>PFCG Name</th>
        <th><%= sortable "telephone" %></th>
        <th><%= sortable "care_givers", change_name("Care Giver") %></th>
        <th>Services</th>
        <th>Calendar</th>
        <th>Medication</th>
        <th><%= sortable "status" %></th>
        <th></th>
      <% else %>
        <th>First Name</th>
        <th>Last Name </th>
        <th>City</th>
        <th>PFCG Name</th>
        <th>Phone</th>
        <th><%= change_name("Care Giver")%></th>
        <th>Services</th>
        <th>Calendar</th>
        <th>Medication</th>
        <th>Status</th>
        <th></th>
        <% end %>
      </tr>
      <% unless @care_clients.empty? %>
        <% @care_clients.each do |care_client| %>
      <tr>
        <td><%= link_to care_client.first_name, edit_fcg_home_path(care_client.id)%></td>
        <td><%= link_to care_client.last_name, edit_fcg_home_path(care_client.id) %></td>
        <td><%= care_client.city %></td>
        <td>-</td>
        <td><%= care_client.telephone %></td>
        <td><a href="" class=<%= care_client.care_givers.count.eql?(0) ? "" : "care_cliet_popup" %> id="farCare-popup-<%= care_client.id %>"><%= care_client.care_givers.count %></a></td>
        <td><a href="" class="service active"><%= link_to (image_tag "services.png", :width =>"20", :height => "18"), fcg_view_services_path(care_client)%></a></td>
        <td class = "<%= care_client.current_event_status %>" ><a href="<%=  calendar_care_client_path(care_client) %>" class="calender active"><%= image_tag "calender.png", :width =>"16", :height => "16"%></a></td>
        <td><a href="" class="coming_soon medications active"><%= image_tag "medication-2.png", :width =>"17", :height => "17"%></a></td>
        <td class="status_change" ><%= status_fcg(care_client.status, care_client.id, params[:page]) %></td>
        <td class="last-td"><%= link_to "", fcg_delete_care_client_path(care_client.id), class: "delete"%></td>
      </tr>
      <% end %>
      <% else %>
        <tr><td colspan="11" class="last-td">No Records Found</td><tr>
      <% end %>
    </table>
  </div>
  <% unless @care_clients.empty? %>
  <div class="row">
  	<%= paginate @care_clients, :outer_window => 1 %>
  </div>
  <% end %>


  <% unless @care_clients.empty? %>
    <% @care_clients.each do |care_client| %>
    <% pcg = care_client.care_givers %>
      <!-- popup -->
      <div id="care-clients" class="farCare-popup farCare-popup-<%= care_client.id %>">
      	<a href="" class="close"></a>
      	<h4 class="m_btm-0">Associated <%= change_name("Care Giver")%>s of <%= care_client.first_name %></h4>
          <div class="row">
          <div id="mcs_container<%= care_client.id%>" class="lists">
          <% scroll_style = pcg.length < 5 ? "height:auto" : "" %>
          <div class="customScrollBox" style=<%= scroll_style %>>
            <div class="container">
            <div class="content">
         	  <ul class="client-lists">
            <% unless pcg.empty? %>
              <% pcg.each do |care_giver|%>
            	  <li><%= link_to get_full_name(care_giver), edit_pcg_home_path(care_giver.id)%></li>
              <% end %>
            <% end %>
            </ul>
            </div>
            </div>
            <div class="dragger_container">
                <div class="dragger"></div>
              </div>
            </div>
            </div>
          </div>
      </div>
    <% end %>
  <% end %>
  <div id="backgroundPopup"></div>



<script type="text/javascript">
function mCustomScrollbars(id){
  var id_string = "#mcs_container"+id;
  $(id_string).mCustomScrollbar("vertical",300,"easeOutCirc",1.05,"auto","yes","yes",15);
}
$(function() {
  var timer;

$(".care_cliet_popup").mouseenter(function(){
   self = $(this);
   timer = setTimeout(function(){
      loadPopup(self)
   },1000)
}).mouseleave(function(){
   clearTimeout(timer);
});


  $(".close").click(function() {
    disablePopup();  // function close pop up
  });

  $(this).keyup(function(event) {
    if (event.which == 27) { // 27 is 'Ecs' in the keyboard
      disablePopup();  // function close pop up
    }
  });

  $("div#backgroundPopup").click(function() {
    disablePopup();  // function close pop up
  });

  function loading() {
    $("div.loader").show();
  }

  function closeloading() {
    $("div.loader").fadeOut('normal');
  }

  var popupStatus = 0; // set value

  function loadPopup(self) {
    var id_name = self.attr('id');
    if(popupStatus == 0) { // if value is 0, show popup
      closeloading(); // fadeout loading
      $("div."+id_name).fadeIn(500); // fadein popup div
      $("#backgroundPopup").css("opacity", "0.7"); // css opacity, supports IE7, IE8
      $("#backgroundPopup").fadeIn(0001);
      popupStatus = 1; // and set value to 1
      var id = id_name.match(/\d+$/);
      mCustomScrollbars(id);
    }
  }
  function disablePopup() {
    if(popupStatus == 1) { // if value is 1, close popup
      $("#care-clients").fadeOut("normal");
      $(".farCare-popup").fadeOut("normal");
      $("#backgroundPopup").fadeOut("normal");
      popupStatus = 0;  // and set value to 0
    }
  }
});
</script>
